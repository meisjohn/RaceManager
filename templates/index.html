{% extends "base.html" %}
{% block content %}
    <h1>Racers</h1>


    {% if error %}
        <p class="error">{{ error }}</p>
    {% endif %}

    {% if session['role'] == 'OWNER' %}
        <h2>Add Racer</h2>

        <form method="POST">
            First Name: <input type="text" name="first_name" autofocus required><br>
        Last Name: <input type="text" name="last_name" required><br>
        Patrol: <select name="patrol" required>
            {% for id, name in patrol_names.items() %}
                    <option value="{{ id }}">{{ name }}</option>
                {% endfor %}
            </select><br>
            <input type="submit" value="Add">
        </form>

        <h2>Racer List</h2>
    {% endif %}

    <table>  <thead>
            <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Patrol</th>
                <th>Car Number</th>
                <th>Car Name</th>
		<th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for p in participants %}
            <tr>
                <td>{{ p.first_name }}</td>
                <td>{{ p.last_name }}</td>
                <td>{{ patrol_names.get(p.patrol) }}</td>
                <td>{{ p.car_number }}</td>
                <td>{{ p.car_name }}</td>
                <td>
                    {% if session['role'] == 'OWNER' %}
                        <a href="/edit_participant/{{ p.car_number }}">Edit</a> |
                        <form method="POST" action="/delete_participant/{{ p.car_number }}" style="display: inline;">
                            <button type="submit" onclick="return confirm('Are you sure you want to delete this participant?')">Delete</button>
                        </form>
                    {% endif %}
                    <a href="/participant_times/{{ p.car_number }}">Race Times</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <br>
    {% if session['role'] == 'OWNER' %}
    <div style="text-align: center;">
	    <a href="javascript:confirmAction('Are you sure you want to clear existing race data and schedule new races?', '/schedule_initial')"><button class="big">Clear Race Data and Schedule First Round</button></a>
    </div>
    {% endif %}
{% endblock %}
